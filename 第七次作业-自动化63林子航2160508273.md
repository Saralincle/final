# <center> 第七次作业  
### <center> 自动化63   
### <center> 林子航   
### <center> 2160508273   
### <center> 2019年5月3日  
## <center> 摘要  
&emsp;&emsp;本次实验使用了多种边缘检测算子对多幅图像进行边缘检测，再在检测后的边缘图像上采用哈夫变换进行直线检测。  
&emsp;&emsp;常用的边缘提取算法包括sobel,roberts和canny算法等等。所谓边缘提取，即保留变化较大的部分，滤去平滑的部分，而一幅图像变化最大的部分莫过于它的边缘，因此边缘提取的基本思想是利用边缘的变化特性进行提取。在实现了三种边缘提取算法以后，我逐个分析了各个滤波器的优缺点，进行对比分析，得到了canny滤波器的边缘提取效果最好这一结论。  
&emsp;&emsp;哈夫变换是常用的直线检测算法，其原理是将xy域通过参数方程变换到参数域，然后通过统计参数域的曲线的交点个数，选取出相交次数最多的几个点，对应的xy域上的几条直线就是我们要检测的直线。  
&emsp;&emsp;通过本次实验，我对各种边缘提取算子的实现原理和实现方法都有了进一步的理解，对哈夫变换的原理也更加了然于心；在对比分析了各个模板的优缺点后，对何种情况选择何种边缘提取模板也更清楚。    
### 一.技术讨论  
#### 1.多种算法实现边缘检测   
&emsp;&emsp;边缘检测的常用算法包括sobel，roberts，canny等，其中canny算法是目前边缘提取应用最广泛，效果最好的算法。边缘检测本质上是让原图像通过一个高通滤波器，各种算法的区别在于滤波器的构造不同。要求滤波器的和为1，目的是在通过平滑图像邻域时，不能产生影响。  
&emsp;&emsp;设原图像的某个3×3大小的邻域的像素点为z1,z2,...,z9，中心的灰度值为M(x,y)，分别给出sobel和roberts的算法：  
![](https://i.imgur.com/aYew9Tw.png)  
![](https://i.imgur.com/qqtUS4Q.png)  
&emsp;&emsp;canny边缘检测，相对于sobel是较为复杂的一种检测算法，也是迄今为止最优秀的一种边缘检测算法，但是不可否认，它也带来了大量的运算。canny边缘检测分为四个步骤：  
&emsp;&emsp;（1）采用高斯滤波器进行平滑滤波；  
&emsp;&emsp;（2）求出梯度的一阶梯度或二阶梯度，初步得到边缘；  
&emsp;&emsp;（3）对梯度图形进行非最大值抑制，并进行双阈值处理；  
&emsp;&emsp;（4）用双阈值算法检测和连接边缘。  
&emsp;&emsp;仅仅得到全局的梯度并不足以确定边缘。因此，为了确定边缘，必须保留局部梯度最大的点，且要抑制非极大值。图像梯度幅值矩阵中的元素值越大，说明图像中该点的梯度值越大，但这并不能说明该点就是边缘。在canny算法中，非极大值抑制是进行边缘检测的重要步骤，通俗意义上是指寻找像素点局部最大值，将非极大值点所对应的灰度值置0，这样可以剔除大部分非边缘的点。  
&emsp;&emsp;将3×3大小的邻域划分为4个梯度方向，分别代表0°，45°，90°，135°。判断像素点M(x,y)是否是极大值时，将该点的灰度值与沿着梯度方向的2个8邻域像素的梯度值M(x±1,y±1)进行比较。若该点位置的梯度幅值没有沿梯度方向的两个相邻像素的梯度值大，则说明该点的梯度值不是局部的最大值，则令M(x,y)=0。这一步骤将会排除非边缘的像素，仅仅保留了一些细的线条，即候选的边缘。  
&emsp;&emsp;最后，对非极大值抑制后的图像进行高低阈值的判断，设低阈值为T1，高阈值为T2，根据判断的情况分为以下三种情况进行处理：  
&emsp;&emsp;（1）如果某一像素位置的梯度幅值超过T2，则该像素被保留为边缘像素；  
&emsp;&emsp;（2）若某像素位置的梯度幅值小于T1，则直接置零；  
&emsp;&emsp;（3）若某一像素位置的梯度幅值介于T1,T2之间，则判断该像素8邻域空间的像素是否存在高于T2的像素。如果存在则该像素保留，否则置零。  
&emsp;&emsp;使用matlab库中自带的边缘检测函数edge对图像进行边缘检测，本次实验使用了sobel,roberts以及canny算法进行边缘检测并进行比较。  
#### 2.哈夫变换实现直线检测   
&emsp;&emsp;哈夫变换方法是利用图像得全局特性而对目标轮廓进行直接检测的方法，在已知区域形状的条件下，哈夫变换可以准确地捕获到目标的边界（连续的获不连续的），并最终以连续曲线的形式输出变换结果，该变换可以从强噪声环境中将已知形状的目标准确得分割提取出来。  
&emsp;&emsp;哈夫变换的核心思想是: 点—线的对偶性。通过变换将图象从图像控件转换到参数空间,在图像空间中一条过点(x,y)的直线方程为y=px+q,通过代数变换可以转换为另一种形式p=-px+y,即参数空间中过点(p,q)的一条直线,如果在图像空间中保持直线的斜率和截距的不变,其在参数空间必定过点(p, q),这也就说明,在图像空间中共线的点对应参数空间共点的线。哈夫变换就是根据上述点—线的对偶性把在图象空间中存在的直线检测问题转换为参数空间中存在的点检测问题,后者的处理要比前者简单易行得多,只需简单地累加统计即可实现对边缘的检测。   
&emsp;&emsp;直线到直线的参数方程存在一个问题，如果直线接近竖直方向，会由于p和q的值都接近无穷而使计算量大增。因此实际中大量采用的是直线的极坐标方程：  
&emsp;&emsp; ![](https://i.imgur.com/UbSeQMB.png)  
&emsp;&emsp;根据这个方程，原图像空间中的点对应新参数空间中的一条正弦曲线，即原来的点—直线对偶性变成了现在的点—正弦曲线对偶性。检测在图像空间中共点的线需要在参数空间里检测正弦曲线的交点。具体的检测步骤如下：  
&emsp;&emsp;（1）在参数空间ρθ里建立一个两维的累加数组——哈夫矩阵。设这个累加数组为H（ρ，θ）；    
&emsp;&emsp;（2）开始时置数组H为零，然后对每一个图像空间中的给定点（x，y），让θ取遍θ轴上所有可能的值，并算出对应的ρ（x，y固定）；  
&emsp;&emsp;（3）再根据ρ和θ的值（设都已经取整）对H累加：H（ρ，θ） = H（ρ，θ）+1；  
&emsp;&emsp;（4）累加结束后，根据H（ρ，θ）处共线点的个数。同时（ρ，θ）值也给出了参数方程，使我们得到了点所在三角函数曲线的方程；  
&emsp;&emsp;（5）如果两个点（x1,y1)和(x2,y2)共线，则有相同的ρ，θ，H（ρ，θ）则可以不断累加；  
&emsp;&emsp;（6）根据哈夫矩阵H选择值最大的N个点，得到xy平面上的N条直线。  
&emsp;&emsp;实验中使用matlab自带的hough,houghpeaks以及houghlines函数实现哈夫变换。  
### 二.实验结果  
检测得到的直线使用绿色标出：  
1.test1直线检测结果：    
![](https://i.imgur.com/h5fsqtV.jpg)  
![](https://i.imgur.com/CHkkKFk.jpg)  
![](https://i.imgur.com/aprVzNF.jpg)  
2.test2直线检测结果：    
![](https://i.imgur.com/BcDzJv1.jpg)  
![](https://i.imgur.com/WxTH7Ug.jpg)  
![](https://i.imgur.com/hgvXVY9.jpg)  
3.test3直线检测结果：    
![](https://i.imgur.com/pLn6ruQ.jpg)  
![](https://i.imgur.com/oMIHsFj.jpg)  
![](https://i.imgur.com/SOhhL6F.jpg)  
4.test4直线检测结果：    
![](https://i.imgur.com/qqlVlDh.jpg)  
![](https://i.imgur.com/QVI7TNC.jpg)  
![](https://i.imgur.com/pJ2gHbH.jpg)  
5.test5直线检测结果：    
![](https://i.imgur.com/G5rQ45x.jpg)  
![](https://i.imgur.com/OLycZ12.jpg)  
![](https://i.imgur.com/fmtdRBE.jpg)  
6.test6直线检测结果：  
![](https://i.imgur.com/BpuTPDM.jpg)   
![](https://i.imgur.com/BOtkxg0.jpg)  
![](https://i.imgur.com/iVkpcrJ.jpg)  
### 三.结果分析  
&emsp;&emsp;从上述展示的实验结果来看，不同算子提取的边缘有不同的特定。下面对各种算子进行具体分析：    
&emsp;&emsp;1.roberts算子：  
&emsp;&emsp;roberts算子是最简单的边缘提取算子，相较于其他的边缘提取算子，roberts算子提取得到的边缘点是最少的，也是最粗糙的，仅仅能提取大致的较明显的边缘，比如一个物体的轮廓，对于物体内部的细节部分的边缘基本无法提取。从直线检测的结果图来看，检测得到的直线数量也是三种边缘提取算子中最少的，原因是因为roberts算子提取得到的边缘点是最少的。    
&emsp;&emsp;2.sobel算子：  
&emsp;&emsp;对比不难发现，sobel算法提取的边缘较roberts算法提取的边缘更为清晰明显，同时提取得到的边缘也更为连续，且相比之下有更多的细节被提取出来。因此使用哈夫变换检测直线时，检测得到的数量也比roberts算子检测得到的更多。总体而言，sobel算法提取得到的边缘效果更好。  
&emsp;&emsp;3.canny算法：  
&emsp;&emsp;canny算法提取的边缘效果则是优于以上所述的2种算法，既清晰不模糊，又准确地提取出了边缘，这也是它广泛应用在边缘提取上的原因。观察实验结果可以看到，canny算法提取得到的边缘点远远多于其他两种算子，将图像中大量的细节边缘都提取出来了，从而使用哈夫变换检测直线时也会检测出更多数量的直线。  
&emsp;&emsp;不同算法都有各自的优缺点，实际应用时应该参照实际情况选择算法。roberts算子和sobel算子虽然提取的边缘比较粗糙，但对于只需要提取大致轮廓的情况已经足够，使用canny算法可能会增加不必要的细节，且增加时间复杂度。而对于需要非常细致的边缘提取要求，则应该应用canny算法。  
&emsp;&emsp;下面讲述一下本次实验使用的matlab自带函数的使用规则以及改变参数对实验结果的影响：  
&emsp;&emsp;首先是边缘提取函数edge，使用格式为：G=edge(F,'')，G表示边缘提取后得到的二值图像，F是输入的灰度图像，单引号内填写使用的算法，包括canny,sobel,roberts等等。  
&emsp;&emsp;然后是直线检测的函数，包括hough,houghpeaks以及houghlines。其中，hough用于对输入图像进行哈夫变换，求得边缘点相对应的参数方程的哈夫矩阵H。使用格式为：[H,T,R]=hough(G,'Theta',value)。其中H,T,R分别表示哈夫矩阵、角度θ以及距离ρ，G表示二值边缘图像，单引号内填写'Theta'表示使用的参数方程可以将xy域变换到上述的ρθ域；value指定θ的值的变化范围，默认为-90°到89.5°。当改变value的值为其他不同的范围时，可以指定检测特定方向的直线。以test5五角大楼为例，当设置value为44:0.5:46时，检测得到的直线将是接近45°角的直线：  
&emsp;&emsp;![](https://i.imgur.com/udhipv7.jpg)  
&emsp;&emsp;当设置value为-46:0.5:-44时，检测得到的直线将是接近-45°角的直线：  
&emsp;&emsp;![](https://i.imgur.com/Nlc8AMV.jpg)  
&emsp;&emsp;houghpeaks函数用于提取hough矩阵中统计量最高的N个点，最后再使用houghlines函数将统计量最高的这几个点变换回xy域，得到N条直线，实现直线检测。  
## <center>实验感想  
&emsp;&emsp;本次实验实现了多种边缘提取模板，并在各自的基础上进行了直线检测，对比分析了各种模板的优缺点以及直线检测的结果；还在改变参数的条件下分析了matlab自带的变换函数的作用，让我对直线检测以及边缘提取算法有了进一步的了解，深入理解了其中的原理，获益匪浅。   